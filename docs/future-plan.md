# MCP gpt-5 パラメータ対応方針（開発エージェント向け）

本ドキュメントは、MCP の `mcp__gpt` ツール（gpt-5）で現在公開されているパラメータを整理し、開発エージェントでの活用方針・既定値・将来拡張の優先度を示すものです。

- 確認ソース
  - 本リポに接続された MCP ツール定義（最小ブリッジ）
  - 参考: mcp__gpt への自己記述問い合わせ（回答は一般的な Responses API 仕様に言及。実装差の可能性あり）

---

## 現状の公開パラメータ（最小ブリッジ）

当該 MCP ツールは「モデル／推論強度（reasoning.effort）／Web 検索フラグ」のみを明示的に受け付ける最小ブリッジです。加えて入力 `input` を渡します。

1) `input`
- 型: 文字列（単一テキスト入力）
- 既定値: なし（必須）
- 注意: 現行ブリッジでは messages/マルチモーダル入力等は非公開。テキストでの指示最適化が前提。
- エージェント有用性: 必須（指示の明確化・文脈圧縮・テンプレ化が効果大）

2) `model`
- 型: 文字列
- 許容値（想定）: `gpt-5` | `gpt-5-mini` | `gpt-5-nano`
- 既定値: 未指定時は `gpt-5`
- 使い分け指針:
  - `gpt-5`: 高精度が必要な大規模リファクタ/設計/仕様統合
  - `gpt-5-mini`: 速度とコスト重視の小規模修正・説明生成
  - `gpt-5-nano`: 超軽量の抽出・単純分類・ルーティング
- エージェント有用性: 高（タスク難易度/制約に応じた動的切替が効果大）

3) `reasoning_effort`
- 型: 文字列
- 許容値: `minimal` | `low` | `medium` | `high`（既定: `medium`）
- 挙動の目安:
  - `minimal`: 思考を抑え速度/コスト最優先（web_search は併用不可）
  - `low`: かるい段取り（要約/言い換え/簡易調査）
  - `medium`: 一般的な分析/設計/コード改変（既定）
  - `high`: 複雑な要件統合・長い思考が必要な設計検討
- エージェント有用性: 高（テスト失敗/難易度上昇時の自動昇格が有効）

4) `web_search`
- 型: 真偽値
- 既定値: `true`（注: 環境やポリシーで制限される場合あり）
- 注意:
  - ネットワーク制限環境では強制的に `false` とするフォールバックが必要
  - `reasoning_effort = minimal` の場合は使用不可
  - 研究系タスクでのみ有効化し、出典ログ/ドメイン許可リスト/クォータでガード
- エージェント有用性: 中（社内/ローカル中心の作業では既定オフが安全）

---

## 推奨デフォルトと動的制御

- 既定値（開発エージェント・ローカル作業前提）
  - `model`: `gpt-5-mini`
  - `reasoning_effort`: `low`（テキスト整形/軽微修正が中心）→ 複雑化時に `medium/high` へ自動昇格
  - `web_search`: `false`（ネットワーク制限/再現性重視）。ユーザー承認で一時的に `true` 可
- 動的切替のヒューリスティクス
  - 変更規模が大（diff > 200行、複数ファイル跨ぎ、設計決定含む）→ `model=gpt-5`, `effort=medium/high`
  - テスト失敗の原因特定/設計レビュー/仕様統合 → `model=gpt-5`, `effort=high`
  - 定型編集/説明文生成 → `model=gpt-5-mini`, `effort=low`
  - ネットワーク不可/禁止 → `web_search=false` を強制

---

## 実装/設計方針（短期）

- セッション既定 + ステップ上書き
  - セッション開始時に既定（上記）を設定し、各ステップで `model/effort/web_search` を個別上書き可能にする
- ポリシーガード
  - `reasoning_effort=minimal` の場合は自動的に `web_search=false`
  - ネットワーク制限/未承認時は常に `web_search=false` を強制
- ロギング/観測
  - ステップごとの選択値、実行時間、トークン推定、失敗要因（例: コンテキスト超過, length stop）を記録
- 失敗時の回復
  - `length` 停止→ `max_output_tokens` 相当の拡張は現行ブリッジ非公開のため、出力分割/要約で再試行
  - 低精度→ `effort` 昇格 or `model` 切替で再試行

---

## 将来拡張（Responses API に準拠した拡張の候補）

現行ブリッジ外の代表的パラメータ（導入優先度つき）。括弧内は開発エージェント観点の便益。

- 高優先度
  - `response_format`（厳密 JSON 出力・機械可読性/安定化）
  - `max_output_tokens`（長文生成・分割戦略との両輪）
  - `tool_choice`/`tools`（関数呼び出し制御・安全なエージェント実行）
  - `stream`（UI 応答性/早期プレビュー/中断）
  - `seed`（再現性向上・差分検証）
- 中優先度
  - `temperature`/`top_p`（創造性/決定性の制御）
  - `metadata`/`user`（監査・レート制御・トレース）
  - `logprobs`/`top_logprobs`（出力信頼度の手がかり、モデル依存）
- 低優先度（モデル依存）
  - `modalities`/`input_image`/`input_audio`/`audio`（マルチモーダル拡張）

段階導入の指針:
- まずは `response_format`, `max_output_tokens`, `stream`, `tools` を追加（コード生成/修正ワークフローの安定化に直結）
- つぎに `temperature`, `seed` を UI/設定から調整可能に

---

## テスト計画（最小単位）

- 単体
  - パラメータ検証（`reasoning_effort` の許容値、`minimal` 時の `web_search=false` 強制）
  - 既定値の適用/上書き（セッション既定→ステップ上書き）
- 疎通/E2E
  - `model` 切替での品質/速度差ログの収集
  - `web_search` 制限環境でのフォールバック（常に false）
  - 変更規模・テスト失敗シグナルでの自動昇格動作

---

## リスクと対策

- コスト上振れ（`gpt-5` + `high` 多用）→ 既定を mini/low、昇格はシグナル駆動・時間/回数ガード
- ネットワーク制限での調査不能 → 常時 `web_search=false`、ローカル情報のみでの手順化/要約を優先
- 非決定性/再現性不足 → `seed` の将来導入、出力検証の自動化（lint/型/ビルド）
- 長文生成の途中打ち切り → 出力分割・要約再試行、将来 `max_output_tokens` 導入

---

## 既定値まとめ（現行実装）

- `model`: 既定 `gpt-5-mini`（自動昇格で `gpt-5`）
- `reasoning_effort`: 既定 `low`（必要に応じ `medium/high` に昇格）
- `web_search`: 既定 `false`（ユーザー承認/許可環境のみ一時的に `true`）

---

## 次アクション（実装順）

1. セッション既定/ステップ上書きの設定面を追加（UI/CLI/設定ファイル）
2. `minimal`→`web_search=false` の強制ガード、ネットワーク制限検知とフォールバック
3. ロギング/観測の整備（選択値・実行時間・エラー種別）
4. 将来拡張の第一弾: `response_format`, `max_output_tokens`, `stream`, `tools` の設計ドラフト
5. ドキュメント更新とサンプルレシピ（難易度別プリセット: 速度/精度/コスト）

以上。
